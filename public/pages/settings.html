<!DOCTYPE html>
<html>
	<head>
		<title>MoarTube - Settings</title>
		<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
		<meta charset="utf-8">
		<script src="/javascript/jquery-3.6.4.min.js"></script>
		<link href="/css/Open+Sans300,400,600,700.css" rel="stylesheet">
		<link href="/css/nucleo-icons.css" rel="stylesheet">
		<link href="/css/nucleo-svg.css" rel="stylesheet">
		<link href="/css/free-5.15.4.min.css" rel="stylesheet">
		<link href="/css/free-v4-font-face-5.15.4.min.css" rel="stylesheet">
		<link href="/css/free-v4-shims-5.15.4.min.css" rel="stylesheet">
		<link href="/css/nucleo-svg.css" rel="stylesheet">
		<link id="pagestyle" href="/css/soft-ui-dashboard-1.1.0.min.css" rel="stylesheet">
		<style>
			.node-avatar {
				border-radius: 50%;
				max-width: 128px;
			}
			
			#node-banner {
				max-width: 1024px;
			}
			
			#secure-connection-modal label {
				margin: 0;
			}
		</style>
	</head>
	<body class="g-sidenav-show bg-gray-100">
		<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3" id="sidenav-main">
			<div class="sidenav-header">
				<i class="fas fa-times p-3 cursor-pointer text-secondary opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
				<a id="node-link" class="navbar-brand m-0" target="_blank">
					<img src="/settings/node/avatar" class="node-avatar navbar-brand-img h-100" alt="main_logo">
					<span class="ms-1 font-weight-bold">MoarTube Client</span>
				</a>
			</div>
			<hr class="horizontal dark mt-0">
			<div class="collapse navbar-collapse w-auto h-auto" id="sidenav-collapse-main">
				<ul class="navbar-nav">
					<li class="nav-item">
						<div class="collapse  show " id="pagesExamples">
							<ul class="nav ms-4 ps-3">
								<li class="nav-item ">
									<a class="nav-link " href="/videos">
										<span class="sidenav-mini-icon"> V </span>
										<span class="sidenav-normal"> Videos </span>
									</a>
								</li>
								<li class="nav-item ">
									<a class="nav-link " href="/comments">
										<span class="sidenav-mini-icon"> C </span>
										<span class="sidenav-normal"> Comments </span>
									</a>
								</li>
								<li class="nav-item ">
									<a class="nav-link collapsed" data-bs-toggle="collapse" aria-expanded="false" href="#reports">
										<span class="sidenav-mini-icon"> R </span>
										<span class="sidenav-normal"> Reports <b class="caret"></b></span>
										<span id="total-report-count" class="badge badge-primary ms-1"></span>
									</a>
									<div class="collapse" id="reports">
										<ul class="nav nav-sm flex-column">
											<li class="nav-item">
												<a class="nav-link " href="/reports/videos">
													<span class="sidenav-mini-icon text-xs"> V </span>
													<span class="sidenav-normal"> Videos </span>
													<span id="video-report-count" class="badge badge-primary ms-1"></span>
												</a>
											</li>
											<li class="nav-item">
												<a class="nav-link " href="/reports/comments">
													<span class="sidenav-mini-icon text-xs"> C </span>
													<span class="sidenav-normal"> Comments </span>
													<span id="comment-report-count" class="badge badge-primary ms-1"></span>
												</a>
											</li>
										</ul>
									</div>
								</li>
								<li class="nav-item ">
									<a class="nav-link active " href="/settings">
										<span class="sidenav-mini-icon"> S </span>
										<span class="sidenav-normal"> Settings </span>
									</a>
								</li>
							</ul>
						</div>
					</li>
					<li class="nav-item">
						<hr class="horizontal dark">
					</li>
					<li class="nav-item">
						<a class="nav-link" href="http://www.moartube.com" target="_blank">
							<div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center  me-2 d-flex align-items-center justify-content-center">
								<svg class="text-dark" width="12px" height="20px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
									<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
									<g transform="translate(-1720.000000, -592.000000)" fill="#FFFFFF" fill-rule="nonzero">
									<g transform="translate(1716.000000, 291.000000)">
									<g transform="translate(4.000000, 301.000000)">
									<path class="color-background" d="M39.3,0.706666667 C38.9660984,0.370464027 38.5048767,0.192278529 38.0316667,0.216666667 C14.6516667,1.43666667 6.015,22.2633333 5.93166667,22.4733333 C5.68236407,23.0926189 5.82664679,23.8009159 6.29833333,24.2733333 L15.7266667,33.7016667 C16.2013871,34.1756798 16.9140329,34.3188658 17.535,34.065 C17.7433333,33.98 38.4583333,25.2466667 39.7816667,1.97666667 C39.8087196,1.50414529 39.6335979,1.04240574 39.3,0.706666667 Z M25.69,19.0233333 C24.7367525,19.9768687 23.3029475,20.2622391 22.0572426,19.7463614 C20.8115377,19.2304837 19.9992882,18.0149658 19.9992882,16.6666667 C19.9992882,15.3183676 20.8115377,14.1028496 22.0572426,13.5869719 C23.3029475,13.0710943 24.7367525,13.3564646 25.69,14.31 C26.9912731,15.6116662 26.9912731,17.7216672 25.69,19.0233333 L25.69,19.0233333 Z"></path>
									<path class="color-background" d="M1.855,31.4066667 C3.05106558,30.2024182 4.79973884,29.7296005 6.43969145,30.1670277 C8.07964407,30.6044549 9.36054508,31.8853559 9.7979723,33.5253085 C10.2353995,35.1652612 9.76258177,36.9139344 8.55833333,38.11 C6.70666667,39.9616667 0,40 0,40 C0,40 0,33.2566667 1.855,31.4066667 Z"></path>
									<path class="color-background" d="M17.2616667,3.90166667 C12.4943643,3.07192755 7.62174065,4.61673894 4.20333333,8.04166667 C3.31200265,8.94126033 2.53706177,9.94913142 1.89666667,11.0416667 C1.5109569,11.6966059 1.61721591,12.5295394 2.155,13.0666667 L5.47,16.3833333 C8.55036617,11.4946947 12.5559074,7.25476565 17.2616667,3.90166667 L17.2616667,3.90166667 Z" opacity="0.598539807"></path>
									<path class="color-background" d="M36.0983333,22.7383333 C36.9280725,27.5056357 35.3832611,32.3782594 31.9583333,35.7966667 C31.0587397,36.6879974 30.0508686,37.4629382 28.9583333,38.1033333 C28.3033941,38.4890431 27.4704606,38.3827841 26.9333333,37.845 L23.6166667,34.53 C28.5053053,31.4496338 32.7452344,27.4440926 36.0983333,22.7383333 L36.0983333,22.7383333 Z" opacity="0.598539807"></path>
									</g>
									</g>
									</g>
									</g>
									</svg>
							</div>
							<span class="nav-link-text ms-1">Home</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="http://www.moartube.com/terms-of-service" target="_blank">
							<div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center  me-2 d-flex align-items-center justify-content-center">
								<svg class="text-dark" width="16px" height="16px" viewBox="0 0 40 44" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
									<g id="Basic-Elements" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"> 
									<g id="Rounded-Icons" transform="translate(-1870.000000, -591.000000)" fill="#FFFFFF" fill-rule="nonzero"> 
									<g id="Icons-with-opacity" transform="translate(1716.000000, 291.000000)"> 
									<g id="document" transform="translate(154.000000, 300.000000)"> 
									<path class="color-background" d="M40,40 L36.3636364,40 L36.3636364,3.63636364 L5.45454545,3.63636364 L5.45454545,0 L38.1818182,0 C39.1854545,0 40,0.814545455 40,1.81818182 L40,40 Z" id="Path" opacity="0.603585379"></path> 
									<path class="color-background" d="M30.9090909,7.27272727 L1.81818182,7.27272727 C0.814545455,7.27272727 0,8.08727273 0,9.09090909 L0,41.8181818 C0,42.8218182 0.814545455,43.6363636 1.81818182,43.6363636 L30.9090909,43.6363636 C31.9127273,43.6363636 32.7272727,42.8218182 32.7272727,41.8181818 L32.7272727,9.09090909 C32.7272727,8.08727273 31.9127273,7.27272727 30.9090909,7.27272727 Z M18.1818182,34.5454545 L7.27272727,34.5454545 L7.27272727,30.9090909 L18.1818182,30.9090909 L18.1818182,34.5454545 Z M25.4545455,27.2727273 L7.27272727,27.2727273 L7.27272727,23.6363636 L25.4545455,23.6363636 L25.4545455,27.2727273 Z M25.4545455,20 L7.27272727,20 L7.27272727,16.3636364 L25.4545455,16.3636364 L25.4545455,20 Z" id="Shape"></path> 
									</g> 
									</g> 
									</g> 
									</g> 
								</svg>
							</div>
							<span class="nav-link-text ms-1">Terms of Service</span>
						</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="http://www.moartube.com/contact-us" target="_blank">
							<div class="icon icon-shape icon-sm shadow border-radius-md bg-white text-center  me-2 d-flex align-items-center justify-content-center">
								<svg width="12px" height="12px" viewBox="0 0 46 42" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
									<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
									<g transform="translate(-1717.000000, -291.000000)" fill="#FFFFFF" fill-rule="nonzero">
									<g transform="translate(1716.000000, 291.000000)">
									<g transform="translate(1.000000, 0.000000)">
									<path class="color-background opacity-6" d="M45,0 L26,0 C25.447,0 25,0.447 25,1 L25,20 C25,20.379 25.214,20.725 25.553,20.895 C25.694,20.965 25.848,21 26,21 C26.212,21 26.424,20.933 26.6,20.8 L34.333,15 L45,15 C45.553,15 46,14.553 46,14 L46,1 C46,0.447 45.553,0 45,0 Z"></path>
									<path class="color-background" d="M22.883,32.86 C20.761,32.012 17.324,31 13,31 C8.676,31 5.239,32.012 3.116,32.86 C1.224,33.619 0,35.438 0,37.494 L0,41 C0,41.553 0.447,42 1,42 L25,42 C25.553,42 26,41.553 26,41 L26,37.494 C26,35.438 24.776,33.619 22.883,32.86 Z"></path>
									<path class="color-background" d="M13,28 C17.432,28 21,22.529 21,18 C21,13.589 17.411,10 13,10 C8.589,10 5,13.589 5,18 C5,22.529 8.568,28 13,28 Z"></path>
									</g>
									</g>
									</g>
									</g>
								</svg>
							</div>
							<span class="nav-link-text ms-1">Contact Us</span>
						</a>
					</li>
				</ul>
			</div>
		</aside>
		<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">
			<nav class="navbar navbar-main navbar-expand-lg position-sticky mt-4 top-1 px-0 mx-4 shadow-none border-radius-xl z-index-sticky" id="navbarBlur" data-scroll="true">
				<div class="container-fluid py-1 px-3">
					<nav aria-label="breadcrumb">
						<h6 class="font-weight-bolder mb-0">Settings</h6>
					</nav>
					<div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
						<div class="ms-md-auto pe-md-3 d-flex align-items-center">
						</div>
						<ul class="navbar-nav  justify-content-end">
							<li class="nav-item d-flex align-items-center">
								<a href="/account/signout" class="nav-link text-body font-weight-bold px-0">
									<i class="fa fa-user me-sm-1" aria-hidden="true"></i>
									<span class="d-sm-inline d-none">Sign Out</span>
								</a>
							</li>
							<li class="nav-item d-xl-none ps-3 d-flex align-items-center">
								<a href="javascript:;" class="nav-link text-body p-0" id="iconNavbarSidenav">
									<div class="sidenav-toggler-inner">
										<i class="sidenav-toggler-line"></i>
										<i class="sidenav-toggler-line"></i>
										<i class="sidenav-toggler-line"></i>
									</div>
								</a>
							</li>
							<li class="nav-item px-3 d-flex align-items-center hidden-elem">
								<a href="javascript:;" class="nav-link text-body p-0">
									<i class="fa fa-cog fixed-plugin-button-nav cursor-pointer" aria-hidden="true"></i>
								</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
			<div class="container-fluid py-4">
				<div class="row my-4">
					<div class="col-12">
						<div id="client-settings-container" class="card mt-4">
							<div class="card-header">
								<h5>Client Settings</h5>
							</div>
							<div class="card-body pt-0">
								<div class="card-body pt-0 d-flex">
									<div class="my-auto ">
										<div class="h-100">
											<p class="mb-0">GPU Acceleration</p>
										</div>
									</div>
									<p id="client-setting-gpu-acceleration-label" class="text-sm text-secondary ms-auto me-3 my-auto"></p>
									<div class="form-check form-switch my-auto">
										<input id="client-setting-gpu-acceleration-checkbox" class="form-check-input" type="checkbox" onclick="toggleClientSettingGpuAccelerationCheckbox(this)">
									</div>
								</div>
							</div>
						</div>
						<div id="node-settings-container" class="card mt-4">
							<div class="card-header">
								<h5>Node Settings</h5>
							</div>
							<div class="card-body pt-0">
								<form id="personalize_settings_node_name_form" role="form" method="POST" action="/settings/node/personalize">
									<div class="card-body pt-0 pb-0">
										<div class="">
											<p class="mb-0">Personalize</p>
										</div>
										<div class="card-body pt-0">
											<div class="row">
												<div class="col-2">
													<label class="form-label">Node Avatar (128x128)</label>
													<div class="input-group">
														<img src="/settings/node/avatar" class="node-avatar cursor-pointer w-100" onclick="document.getElementById('avatar_file_input').click();">
													</div>
												</div>
												<div class="col-6">
													<label class="form-label">Node Banner (2560x424)</label>
													<div class="input-group">
														<img id="node-banner" src="/settings/node/banner" class="cursor-pointer w-100" onclick="document.getElementById('banner_file_input').click();">
													</div>
												</div>
											</div>
											<div class="row mt-3">
												<div class="col-12">
													<label class="form-label">Node Name</label>
													<div class="input-group">
														<!-- 
														https://bugs.jquery.com/ticket/10891
														name="nodeName" will create a runtime error because in JQuery "nodeName" is a reserved keyword (property, attribute, function name, etc...)
														that feeling when you're about 70% done with a project and you encounter shit like this
														and then you realize that this library is balls deep in your code
														lol
														-->
														<input id="node-name-input" class="form-control" name="nodeNameJustCuz" type="text" placeholder="node name" onfocus="focused(this)" onfocusout="defocused(this)">
													</div>
												</div>
											</div>
											<div class="row mt-3">
												<div class="col-12">
													<label class="form-label">Node About</label>
													<div class="input-group">
														<textarea id="node-about-textarea" class="form-control" name="nodeAbout" type="text" placeholder="about this node" rows="5" maxlength="100" onfocus="focused(this)" onfocusout="defocused(this)"></textarea>
													</div>
												</div>
											</div>
											<div class="row mt-3">
												<div class="col-12">
													<label class="form-label">Node ID</label>
													<div class="input-group">
														<input id="node-id-input" class="form-control" name="nodeId" type="text" placeholder="node id" onfocus="focused(this)" onfocusout="defocused(this)">
													</div>
												</div>
											</div>
										</div>
										<div class="card-body d-sm-flex pt-0"><div class="d-flex align-items-center mb-sm-0 mb-4 ms-auto"><button class="btn btn-primary mb-0" type="submit" name="button">Save</button></div></div>
									</div>
								</form>
								<div class="card-body pt-0 pb-0">
									<div class="">
										<p class="mb-0">Secure Mode (HTTPS)</p>
									</div>
									<div class="card-body pt-0">
										<div class="row">
											<div class="col-6">
												<div class="form-check form-switch my-auto">
													<input id="node-setting-secure-mode-checkbox" class="form-check-input" type="checkbox" onclick="toggleNodeSettingSecureModeCheckbox(this)"/>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="card-body pt-0 pb-0">
									<div class="">
										<p class="mb-0">Cloudflare One-Click Integration</p>
									</div>
									<div class="card-body pt-0">
										<div class="row">
											<div class="col-6">
												<div class="form-check form-switch my-auto">
													<input id="cloudflare-one-click-integration-checkbox" class="form-check-input" type="checkbox" onclick="toggleCloudflareIntegrationCheckbox(this)">
												</div>
											</div>
										</div>
									</div>
								</div>
								<form id="internal_network_settings_form" role="form" method="POST" action="/settings/node/network/internal">
									<div class="card-body pt-0 pb-0">
										<div class="">
											<p class="mb-0">What port is your node listening on?</p>
										</div>
										<div class="card-body pt-0">
											<div class="row">
												<div class="col-12">
													<label class="form-label">node listening port</label>
													<div class="input-group">
														<input id="node-listening-port-input" name="nodeListeningPort" class="form-control" type="text" placeholder="0 - 65535" onfocus="focused(this)" onfocusout="defocused(this)">
													</div>
												</div>
											</div>
										</div>
										<div class="card-body d-sm-flex pt-0"><div class="d-flex align-items-center mb-sm-0 mb-4 ms-auto"><button class="btn btn-primary mb-0" type="submit" name="button">Save</button></div></div>
									</div>
								</form>
								<form id="external_network_settings_form" role="form" method="POST" action="/settings/node/network/external">
									<div class="card-body pt-0 pb-0">
										<div class="">
											<p class="mb-0">How Can MoarTube Find Your Node?</p>
										</div>
										<div class="card-body pt-0">
											<div class="row">
												<div class="col-4">
													<label class="form-label">public node protocol</label>
													<div class="input-group">
														<select id="public-node-protocol-select" name="publicNodeProtocol" class="multisteps-form__select form-control">
															<option value="" disabled selected>...</option>
															<option value="http">HTTP</option>
															<option value="https">HTTPS</option>
														</select>
													</div>
												</div>
												<div class="col-4">
													<label class="form-label">public ip address / domain</label>
													<div class="input-group">
														<input id="public-node-address-input" name="publicNodeAddress" class="form-control" type="text" placeholder="example.com / xxx.xxx.xxx.xxx" onfocus="focused(this)" onfocusout="defocused(this)">
													</div>
												</div>
												<div class="col-4">
													<label class="form-label">public node port</label>
													<div class="input-group">
														<input id="public-node-port-input" name="publicNodePort" class="form-control" type="text" placeholder="0 - 65535" onfocus="focused(this)" onfocusout="defocused(this)">
													</div>
												</div>
											</div>
										</div>
										<div class="card-body d-sm-flex pt-0"><div class="d-flex align-items-center mb-sm-0 mb-4 ms-auto"><button class="btn btn-primary mb-0" type="submit" name="button">Save</button></div></div>
									</div>
								</form>
								<form id="account_credentials_settings_form" role="form" method="POST" action="/settings/node/account">
									<div class="card-body pt-0 pb-0">
										<div class="">
											<p class="mb-0">Account Credentials</p>
										</div>
										<div class="card-body pt-0">
											<div class="row">
												<div class="col-6">
													<label class="form-label">Username</label>
													<div class="input-group">
														<input name="username" class="form-control" type="text" placeholder="username" onfocus="focused(this)" onfocusout="defocused(this)" autocomplete="off">
													</div>
												</div>
												<div class="col-6">
													<label class="form-label">Password</label>
													<div class="input-group">
														<input name="password" class="form-control" type="text" placeholder="password" onfocus="focused(this)" onfocusout="defocused(this)" autocomplete="off">
													</div>
												</div>
											</div>
										</div>
										<div class="card-body d-sm-flex pt-0"><div class="d-flex align-items-center mb-sm-0 mb-4 ms-auto"><button class="btn btn-primary mb-0" type="submit" name="button">Save</button></div></div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>

		<input id="avatar_file_input" class="hidden-elem" type="file" accept=".jpg,.png"/>
		<input id="banner_file_input" class="hidden-elem" type="file" accept=".jpg,.png"/>

		<script src="/javascript/popper-2.11.6.min.js"></script>
		<script src="/javascript/bootstrap-5.2.2.min.js"></script>
		<script src="/javascript/perfect-scrollbar-1.5.1.min.js"></script>
		<script src="/javascript/sweetalert-11.0.11.min.js"></script>
		<script src="/javascript/soft-ui-dashboard-1.1.0.min.js"></script>

		<script>
			let NODE_PROTOCOL;
			let NODE_ADDRESS;
			let NODE_PORT;
			
			let NODE_BASE_URL;
			
			$(document).ready(async function() {
				getNodeInformation();
				getReportCounts();
				getClientSettings();
				getNodeSettings();
			});
			
			function getNodeInformation() {
				return new Promise(function(resolve, reject) {
					$.ajax({type: 'GET', url: '/node'})
					.done(function (data, textStatus, xhr) {
						if(data.isError) {
							reject();
						}
						else {
							const nodeInformation = data.nodeInformation;
						
							NODE_PROTOCOL = nodeInformation.publicNodeProtocol;
							NODE_ADDRESS = nodeInformation.publicNodeAddress;
							NODE_PORT = nodeInformation.publicNodePort;
							
							NODE_BASE_URL = NODE_PROTOCOL + '://' + NODE_ADDRESS + ':' + NODE_PORT;
							
							$('#node-link').attr('href', NODE_BASE_URL);
							
							resolve();
						}
					})
					.fail(function()
					{
						console.log('unable to communicate with node');
						
						reject();
					});
				});
			}
			
			function getReportCounts() {
				return new Promise(function(resolve, reject) {
					$.ajax({type: 'GET', url: '/reports/count'})
					.done(function (data, textStatus, xhr)
					{
						if(data.isError) {
							reject();
						}
						else {
							const videoReportCount = data.videoReportCount;
							const commentReportCount = data.commentReportCount;
							const totalReportCount = data.totalReportCount;
							
							if(videoReportCount > 0) {
								$('#video-report-count').text(videoReportCount);
							}
							
							if(commentReportCount > 0) {
								$('#comment-report-count').text(commentReportCount);
							}
							
							if(totalReportCount > 0) {
								$('#total-report-count').text(totalReportCount);
							}
							
							resolve();
						}
					})
					.fail(function()
					{
						console.log('unable to communicate with node');
						
						reject();
					});
				});
			}
			
			function getClientSettings() {
				$.ajax({type: 'GET', url: '/settings/client'})
				.always(function() {
					$('#client-setting-gpu-acceleration-checkbox').prop('disabled', false);
				})
				.done(function (data, textStatus, xhr) {
					if(data.isError) {
						showAlert(true, data.message);
					}
					else {
						const clientSettings = data.clientSettings;
						
						if(clientSettings.isGpuAccelerationEnabled) {
							const gpuVendorAndModel = clientSettings.gpuVendor + ' ' + clientSettings.gpuModel;
						
							$('#client-setting-gpu-acceleration-checkbox').prop('checked', true);
							$('#client-setting-gpu-acceleration-label').text(gpuVendorAndModel);
						}
						else {
							$('#client-setting-gpu-acceleration-label').text('disabled');
						}
					}
				})
				.fail(function() {
					console.log('unable to communicate with node');
				});
			}
			
			function getNodeSettings() {
				$.ajax({type: 'GET', url: '/settings/node'})
				.always(function() {
					
				})
				.done(function (data, textStatus, xhr) {
					if(data.isError) {
						showAlert(true, data.message);
					}
					else {
						const nodeSettings = data.nodeSettings;
						
						$('#node-name-input').val(nodeSettings.nodeName);
						$('#node-about-textarea').val(nodeSettings.nodeAbout);
						$('#node-id-input').val(nodeSettings.nodeId);

						$('#node-setting-secure-mode-checkbox').prop('checked', nodeSettings.isSecure);
						$('#cloudflare-one-click-integration-checkbox').prop('checked', nodeSettings.isCloudflareIntegrated);
						
						$('#node-listening-port-input').val(nodeSettings.nodeListeningPort);
						
						$('#public-node-protocol-select').val(nodeSettings.publicNodeProtocol);
						$('#public-node-address-input').val(nodeSettings.publicNodeAddress);
						$('#public-node-port-input').val(nodeSettings.publicNodePort);
					}
				})
				.fail(function() {
					console.log('unable to communicate with node');
				});
			}
			
			$(document).on('change', '#avatar_file_input', function(event) {
				const file = this.files[0];
				
				let formData = new FormData();
				
				formData.append('avatar_file', file);

				this.value = null;
				
				$.ajax({type: 'POST', url: '/settings/node/avatar', data: formData, processData: false, contentType: false})
				.done(function (data, textStatus, xhr)
				{
					if(data.isError)
					{
						showAlert(true, data.message);
					}
					else
					{
						fetch('/settings/node/avatar')
						.then(response => {
							if (response.ok) {
								return response.blob();
							}
							throw new Error('...something went wrong...');
						})
						.then(blob => {
							const objectURL = URL.createObjectURL(blob);
							
							$('.node-avatar').attr('src', objectURL);
						})
						.catch(error => {
							showAlert(true, 'an error occurred, please try again');
						});
					}
				})
				.fail(function()
				{
					showAlert(true, 'an error occurred, please try again');
				});
			});
			
			$(document).on('change', '#banner_file_input', function(event) {
				const file = this.files[0];
				
				let formData = new FormData();
				
				formData.append('banner_file', file);

				this.value = null;
				
				$.ajax({type: 'POST', url: '/settings/node/banner', data: formData, processData: false, contentType: false})
				.done(function (data, textStatus, xhr)
				{
					if(data.isError)
					{
						showAlert(true, data.message);
					}
					else
					{
						fetch('/settings/node/banner')
						.then(response => {
							if (response.ok) {
								return response.blob();
							}
							throw new Error('...something went wrong...');
						})
						.then(blob => {
							const objectURL = URL.createObjectURL(blob);
							
							$('#node-banner').attr('src', objectURL);
						})
						.catch(error => {
							showAlert(true, 'an error occurred, please try again');
						});
					}
				})
				.fail(function()
				{
					showAlert(true, 'an error occurred, please try again');
				});
			});
			
			$("#personalize_settings_node_name_form").submit(function(event) {
				event.preventDefault();

				let form = $(this);

				let url = form.attr('action');
				let nodeName = form.find('input[name="nodeNameJustCuz"]').val();
				let nodeAbout = form.find('textarea[name="nodeAbout"]').val();
				let nodeId = form.find('input[name="nodeId"]').val();

				$.post(url, {nodeName: nodeName, nodeAbout: nodeAbout, nodeId: nodeId})
				.done(function(data) {
					if(data.isError) {
						showAlert(true, data.message);
					}
					else {
						showAlert(false);
					}
				})
				.fail(function() {
					showAlert(true, 'an error occurred, please try again');
				});
			});
			
			$("#internal_network_settings_form").submit(function(event) {
				event.preventDefault();

				let form = $(this);

				let url = form.attr('action');
				let nodeListeningPort = form.find('input[name="nodeListeningPort"]').val();
				
				Swal.fire({
					title: 'please wait',
					text: '...changing node listening port...',
					timer: 5000,
					timerProgressBar: true,
					allowOutsideClick: false,
					didOpen: () => {
						Swal.showLoading()
						
						$.post(url, {nodeListeningPort: nodeListeningPort})
						.done(function(data) {
							if(data.isError) {
								showAlert(true, data.message);
							}
							else {
								
							}
						})
						.fail(function() {
							showAlert(true, 'an error occurred, please try again');
						});
					}
				}).then((result) => {
					if (result.dismiss === Swal.DismissReason.timer) {
						showAlert(false);
					}
				});
			});
			
			$("#external_network_settings_form").submit(function(event) {
				event.preventDefault();

				let form = $(this);

				let url = form.attr('action');
				
				let publicNodeProtocol = form.find('select[name="publicNodeProtocol"]').val();
				let publicNodeAddress = form.find('input[name="publicNodeAddress"]').val();
				let publicNodePort = form.find('input[name="publicNodePort"]').val();
				
				if(publicNodeProtocol != null && publicNodeAddress !== '' && publicNodePort !== '') {
					$.post(url, {publicNodeProtocol: publicNodeProtocol, publicNodeAddress: publicNodeAddress, publicNodePort: publicNodePort})
					.done(function(data) {
						if(data.isError) {
							showAlert(true, data.message);
						}
						else {
							showAlert(false);
						}
					})
					.fail(function() {
						showAlert(true, 'an error occurred, please try again');
					});
				}
			});

			$("#account_credentials_settings_form").submit(function(event) {
				event.preventDefault();

				let form = $(this);

				let url = form.attr('action');
				let username = form.find('input[name="username"]').val();
				let password = form.find('input[name="password"]').val();
				
				if(username !== '' && password !== '') {
					$.post(url, {username: username, password: password})
					.done(function(data) {
						if(data.isError) {
							showAlert(true, data.message);
						}
						else {
							form.find('input[name="username"]').val('');
							form.find('input[name="password"]').val('');
							
							showAlert(false);
						}
					})
					.fail(function() {
						showAlert(true, 'an error occurred, please try again');
					});
				}
			});
			
			function toggleClientSettingGpuAccelerationCheckbox(checkbox) {
				const isGpuAccelerationEnabled = $(checkbox).is(':checked');
				
				$(checkbox).prop('disabled', true);
				
				if(isGpuAccelerationEnabled) {
					$('#client-setting-gpu-acceleration-label').text('...enabling...');
				}
				else {
					$('#client-setting-gpu-acceleration-label').text('...disabling...');
				}
				
				$.ajax({type: 'POST', url: '/settings/client/gpuAcceleration', data: JSON.stringify({isGpuAccelerationEnabled: isGpuAccelerationEnabled}), contentType: 'application/json; charset=utf-8'})
				.always(function() {
					$(checkbox).prop('disabled', false);
				})
				.done(function (data, textStatus, xhr) {
					if(data.isError) {
						$(checkbox).prop('checked', !isGpuAccelerationEnabled);
						
						showAlert(true, data.message);
					}
					else {
						if(data.result.isGpuAccelerationEnabled) {
							const gpuVendorAndModel = data.result.gpuVendor + ' ' + data.result.gpuModel;
							$('#client-setting-gpu-acceleration-label').text(gpuVendorAndModel);
						}
						else {
							$('#client-setting-gpu-acceleration-label').text('disabled');
						}
					}
				})
				.fail(function() {
					$(checkbox).prop('checked', !isGpuAccelerationEnabled);
				});
			}
			
			function toggleNodeSettingSecureModeCheckbox(checkbox) {
				const isCheckboxChecked = $(checkbox).prop('checked');
				
				if(isCheckboxChecked) {
					let revertAction = true;
					
					const html = '\
					<div id="secure-connection-modal" class="container-fluid py-4">\
						<div class="input-group mb-3"><label class="input-group-text" for="key-file-input"><b>key file</b></label><input type="file" class="form-control" id="key-file-input"></div>\
						<div class="input-group mb-3"><label class="input-group-text" for="cert-file-input"><b>cert file</b></label><input type="file" class="form-control" id="cert-file-input"></div>\
						<div class="input-group mb-3"><label class="input-group-text" for="ca-files-input"><b>ca files</b></label><input type="file" multiple class="form-control" id="ca-files-input"></div>\
					</div>';
					
					Swal.fire({
						title: 'upload SSL files',
						html: html,
						showCloseButton: true,
						willOpen: () => {
							
						},
						didOpen: () => {
							
						},
						preConfirm: () => {
							Swal.showLoading();
						
							const keyFile = $('#key-file-input').get(0).files[0];
							const certFile = $('#cert-file-input').get(0).files[0];
							const caFiles = $('#ca-files-input').get(0).files;
							
							let formData = new FormData();
							
							formData.append('keyFile', keyFile);
							formData.append('certFile', certFile);
							
							for (let i = 0; i < caFiles.length; i++) {
								formData.append('caFiles', caFiles[i]);
							}

							Swal.fire({
								title: 'please wait',
								text: '...enabling secure HTTPS mode...',
								timer: 5000,
								timerProgressBar: true,
								didOpen: () => {
									Swal.showLoading();

									$.ajax({type: 'POST', url: '/settings/node/secure?isSecure=' + isCheckboxChecked, data: formData, processData: false, contentType: false})
									.done(function (data, textStatus, xhr) {
										if(data.isError) {
											$(checkbox).prop('checked', !isCheckboxChecked);
											
											showAlert(true, data.message);
										}
									})
									.fail(function() {
										showAlert(true, 'an error occurred, please try again');
									});
								}
							}).then((result) => {
								if (result.dismiss === Swal.DismissReason.timer) {
									showAlert(false);
								}
							});

							return false;
						}
					})
					.then((result) => {
						if(revertAction) {
							$(checkbox).prop('checked', !isCheckboxChecked);
						}
					});
				}
				else {
					Swal.fire({
						title: 'please wait',
						text: '...enabling non-secure HTTP mode...',
						timer: 5000,
						timerProgressBar: true,
						didOpen: () => {
							Swal.showLoading();

							let formData = new FormData();
							
							$.ajax({type: 'POST', url: '/settings/node/secure?isSecure=' + isCheckboxChecked, data: formData, processData: false, contentType: false})
							.done(function (data, textStatus, xhr) {
								if(data.isError) {
									$(checkbox).prop('checked', !isCheckboxChecked);
									
									showAlert(true, data.message);
								}
							})
							.fail(function() {
								showAlert(true, 'an error occurred, please try again');
							});
						}
					}).then((result) => {
						if (result.dismiss === Swal.DismissReason.timer) {
							showAlert(false);
						}
					});
				}
			}

			function toggleCloudflareIntegrationCheckbox(checkbox) {
				const isCheckboxChecked = $(checkbox).prop('checked');
				
				if(isCheckboxChecked) {
					let revertAction = true;
					
					const html = '\
					<div id="secure-connection-modal" class="container-fluid">\
						<div class="input-group mb-3"><input id="cloudflareEmailAddress" class="form-control" type="text" required="" autocomplete="off" placeholder="Email Address"></div>\
						<div class="input-group mb-3"><input id="cloudflareZoneId" class="form-control" type="text" required="" autocomplete="off" placeholder="Zone ID"></div>\
						<div class="input-group"><input id="cloudflareGlobalApiKey" class="form-control" type="text" required="" autocomplete="off" placeholder="Global API Key"></div>\
					</div>';
					
					Swal.fire({
						title: 'Cloudflare Integration',
						html: html,
						showCloseButton: true,
						showConfirmButton: true,
						confirmButtonText: 'Integrate',
						willOpen: () => {
							
						},
						didOpen: () => {
							
						},
						preConfirm: () => {
							Swal.showLoading();

							const cloudflareEmailAddress = $('#cloudflareEmailAddress').val();
							const cloudflareZoneId = $('#cloudflareZoneId').val();
							const cloudflareGlobalApiKey = $('#cloudflareGlobalApiKey').val();

							Swal.fire({
								title: 'please wait',
								text: '...enabling Cloudflare integration...',
								showConfirmButton: false,
								willOpen: () => {
									Swal.showLoading();
								},
								didOpen: () => {
									$.post('/settings/node/cloudflare/configure', {cloudflareEmailAddress: cloudflareEmailAddress, cloudflareZoneId: cloudflareZoneId, cloudflareGlobalApiKey: cloudflareGlobalApiKey})
									.done(function (data, textStatus, xhr) {
										if(data.isError) {
											$(checkbox).prop('checked', !isCheckboxChecked);

											showAlert(true, data.message);
										}
										else {
											showAlert(false, 'Cloudflare integration enabled');
										}
									})
									.fail(function() {
										showAlert(true, 'an error occurred, please try again');
									});
								}
							});
							
							return false;
						}
					})
					.then((result) => {
						if(revertAction) {
							$(checkbox).prop('checked', !isCheckboxChecked);
						}
					});
				}
				else {
					Swal.fire({
						title: 'please wait',
						text: '...disabling Cloudflare integration...',
						showConfirmButton: false,
						didOpen: () => {
							Swal.showLoading();

							$.post('/settings/node/cloudflare/clear', {})
							.done(function(data) {
								if(data.isError) {
									$(checkbox).prop('checked', !isCheckboxChecked);
									
									showAlert(true, data.message);
								}
								else {
									showAlert(false, 'Cloudflare integration disabled');
								}
							})
							.fail(function() {
								showAlert(true, 'an error occurred, please try again');
							});
						}
					});
				}
			}
			
			function showAlert(isError, text) {
				if(isError) {
					Swal.fire({
						text: text,
						icon: 'warning',
						confirmButtonColor: '#3085d6',
						confirmButtonText: 'Ok'
					});
				}
				else {
					const swalObject = {
						icon: 'success',
						showConfirmButton: false,
						timer: 1500
					};

					if(text) {
						swalObject.text = text;
					}

					Swal.fire(swalObject)
				}
			}
		</script>
	</body>
</html>